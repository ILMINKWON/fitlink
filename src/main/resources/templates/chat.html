<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>실시간 채팅</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
        .chat-container {
            width: 360px;
            margin: 40px auto;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            padding: 20px;
            background: #fff;
        }

        #chat-box {
            height: 400px;
            background: #f7f7f7;
            padding: 15px;
            overflow-y: auto;
            border-radius: 10px;
        }

        .my-message { text-align: right; margin-bottom: 10px; }
        .my-message span {
            background: #d8f1ff;
            padding: 8px 12px;
            border-radius: 12px;
            display: inline-block;
        }

        .other-message { text-align: left; margin-bottom: 10px; }
        .other-message span {
            background: #fff;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 12px;
            display: inline-block;
        }
    </style>
</head>

<body>
<div class="chat-container">
    <h5 class="fw-bold text-center mb-3">회원과의 실시간 채팅</h5>

    <div id="chat-box"></div>

    <div class="input-group mt-3">
        <input id="chat-input" class="form-control" placeholder="메시지를 입력하세요">
        <button class="btn btn-primary" onclick="sendMessage()">전송</button>
    </div>
</div>

<!-- SockJS + STOMP -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
    const myName = "선생님";     // WebSocket 연결
    let socket = new SockJS("/ws-chat");
    let stomp = Stomp.over(socket);

    stomp.connect({}, function () {
        stomp.subscribe("/topic/chat", function (msg) {
            const data = JSON.parse(msg.body);
            const chatBox = document.getElementById("chat-box");

            // 내가 보낸 메시지는 여기서 표시하면 안 됨
            if (data.sender !== myName) {
                chatBox.innerHTML += `
                    <div class="other-message">
                        <span>${data.sender}: ${data.message}</span>
                    </div>
                `;
            }

            chatBox.scrollTop = chatBox.scrollHeight;
        });
    });

    // 메시지 전송
    function sendMessage() {
        const msg = document.getElementById("chat-input").value;
        if (!msg.trim()) return;

        stomp.send("/app/send", {}, JSON.stringify({
            sender: myName,
            message: msg
        }));

        const chatBox = document.getElementById("chat-box");
        chatBox.innerHTML += `
            <div class="my-message">
                <span>${msg}</span>
            </div>
        `;
        document.getElementById("chat-input").value = "";
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>

</body>
</html>
